import React, { useEffect, useState } from 'react'
import MyButton from '../myButton/myButton'
import './fetchFox.css'
import Loader from '../loader/Loader'

// 5. –ü—Ä–æ—Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–ª–∏ –¥–∞–Ω–Ω—ã–µ —Å —Å–µ—Ä–≤–µ—Ä–∞
interface IFoxData {
    image: string
    link: string
}

export default function FetchFox():JSX.Element {

    // 3. –°–æ–∑–¥–∞–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏ —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –µ—ë –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å –ø–æ–º–æ—â—å—é useState. –í–Ω–µ–π –±—É–¥–µ—Ç —Ö—Ä–∞–Ω–∏—Ç—Å—è –∫–∞—Ä—Ç–∏–Ω–∫–∞ —Å —Å–µ—Ä–≤–µ—Ä–∞
    const[foxImg, setFoxImg] = useState<string>('')

    // 7. –°–æ–∑–¥–∞–Ω–∏–µ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è loader –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
    const [loading, setLoading] = useState<boolean>(true)

    // 1. –§—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —Å —Å–µ—Ä–≤–µ—Ä–∞ (Promise –¥–æ–±–∞–≤–∏–ª–∏ –≤ —Å–∞–º–æ–º –∫–æ–Ω—Ü–µ)
    const fetchFox = async ():Promise<void> => {
        const res = await fetch('https://randomfox.ca/floof/')
        const data: IFoxData = await res.json()
        console.log(data)
        // 4. –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é —Å–æ—Å—Ç–æ—è–Ω–∏—è –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
        setFoxImg(data.image)
        // 8. –í—ã–∫–ª—é—á–∞–µ–º loader –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞–≤ –∑–Ω–∞—á–µ–Ω–∏—è –Ω–∞ false
        setLoading(false)
    }
    
    // 10. –î–µ–ª–∞–µ–º –æ—Ç–¥–µ–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫, –∫–æ—Ç–æ—Ä–∞—è —Å–Ω–∞—á–∞–ª–∞ –≤—ã–∑—ã–≤–∞–µ—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫, –∞ –ø–æ—Ç–æ–º –æ–±–Ω–æ–≤–ª—è–µ—Ç –ª–∏—Å—É
    const handleGetFox = () => {
        setLoading(true)
        // 12. –î–æ–±–∞–≤–ª—è–µ–º setTimeout –¥–ª—è –±–æ–ª–µ–µ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è loader'–∞ –ø–µ—Ä–µ–¥ –∑–∞–≥—Ä—É–∑–∫–æ–π –∫–∞—Ä—Ç–∏–Ω–∫–∏ —Å –ª–∏—Å–æ–π
        setTimeout(() => {
            fetchFox()
        }, 500)
    }

    // 2. –ü–æ–º–µ—Å—Ç–∏–ª–∏ —Ñ—É–Ω–∫—Ü–∏—é –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É useEffect() c –ø—É—Å—Ç—ã–º –º–∞—Å—Å–∏–≤–æ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–¥–ª—è –≤—ã–∑–æ–≤–∞ —Ç–æ–ª—å–∫–æ –≤ –Ω–∞—á–∞–ª–µ —Ü–∏–∫–ª–∞
    useEffect(() => {
        fetchFox()
    }, [])

    return (
        <div className='lesson-container'>
            <h2>FetchFox ü¶ä</h2>
            {/* 6. –î–æ–±–∞–≤–∏–ª–∏ –≤ –≤–µ—Ä—Å—Ç–∫—É –∫–∞—Ä—Ç–∏–Ω–∫—É –∏ –∫–Ω–æ–ø–∫—É —Å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–º onClick –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–∏ */}
            {/* 11. –ó–∞–º–µ–Ω—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é –≤ –∫–Ω–æ–ø–∫–µ —Å fetchFox –Ω–∞ handleGetFox (–¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã —Å–Ω–∞—á–∞–ª–∞ –≤—ã–∑—ã–≤–∞–ª—Å—è loader) */}
            <MyButton func={handleGetFox} text='get fox'/>

            {/* 9.1. –î–æ–±–∞–≤–ª—è–µ–º loader –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É loader —Å–Ω–∞—á–∞–ª–∞ —Å—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –Ω–µ –±—É–¥–µ—Ç) */}
            {loading ? <Loader/> : (
            <div className="fox-wrapper">
                <img src={foxImg} alt="" />
            </div>
            )}
            {/* 9.2. –£–¥–∞–ª—è–µ–º –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Å loader'–æ–º */}
            {/* <Loader/> */}
        </div>
    )
    }
